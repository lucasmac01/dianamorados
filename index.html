<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gatinho ‚ù§Ô∏è Gatinha</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --accent: #f87171; }
    body { background: #f9fafb; }
    .pop { animation: pop .3s ease-out; }
    @keyframes pop { 0%{transform:scale(.96);opacity:.7} 60%{transform:scale(1.04);opacity:1} 100%{transform:scale(1);} }
    .pulse { animation: pulse 1.5s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{transform:scale(1);opacity:1;} 50%{transform:scale(1.15);opacity:0.85;} }
    .soft { box-shadow: 0 2px 10px rgba(0,0,0,.05); }
    .card { background:white; border-radius:1.25rem; padding:2.5rem; }
    /* anima√ß√£o leve no bot√£o */
    .btn-breath{animation:breath 2.2s ease-in-out infinite}
    @keyframes breath{0%{transform:translateZ(0) scale(1)}50%{transform:translateZ(0) scale(1.015)}100%{transform:translateZ(0) scale(1)}}
  </style>
</head>
<body class="text-gray-800 antialiased">
  <header class="py-2 text-center bg-[var(--accent)]/15 border-b border-[var(--accent)]/30">
    <div class="text-base font-semibold text-[var(--accent)]">Gatinho ‚ù§Ô∏è Gatinha</div>
  </header>

  <main class="flex flex-col items-center justify-center px-6 pb-12 mt-10">
    <section class="card text-center max-w-md w-full soft">
      <h1 class="text-3xl font-bold text-[var(--accent)]">Nosso Tempo</h1>

      <div class="mt-8 flex flex-col items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-[var(--accent)] pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21s-6-4.35-8-8.53C2 9.6 3.6 6 7.14 6c2.02 0 3.19 1.12 3.66 2.05C11.47 7.12 12.64 6 14.66 6c3.54 0 5.14 3.6 3.84 6.47C18 16.65 12 21 12 21z"/></svg>
        <p class="mt-5 text-lg text-gray-700">Juntos h√°</p>
        <div class="mt-1 flex items-baseline gap-2">
          <span id="totalDays" class="text-7xl font-extrabold text-[var(--accent)] pop">‚Äî</span>
          <span class="text-lg font-semibold text-[var(--accent)]/90">dias</span>
        </div>
        <p id="sinceDate" class="mt-2 text-xs text-gray-400">Desde 15/02/2025</p>
      </div>
    </section>

    <section class="card mt-8 text-center max-w-md w-full soft">
      <h2 class="text-lg font-semibold text-gray-900">Cart√£o + Brinde do m√™s</h2>
      <p id="redeemStatus" class="mt-1 text-xs text-gray-500">Verificando‚Ä¶</p>

      <button id="btnRedeem" class="btn-breath mt-6 w-full rounded-full py-3 text-sm font-semibold transition focus:outline-none focus:ring-2 focus:ring-offset-2 shadow-sm">
        Resgatar no dia 15
      </button>

      <div id="giftArea" class="mt-6 hidden">
        <div class="rounded-xl border p-4">
          <p id="giftMessage" class="text-gray-700"></p>
          <p class="mt-2 text-xs uppercase tracking-wide text-gray-500">Brinde</p>
          <p id="giftCode" class="mt-1 font-mono text-sm text-gray-900 select-all">‚Äî</p>
        </div>
      </div>
    </section>

    <footer class="mt-10 text-xs text-gray-400 text-center">
      Feito com <span class="text-[var(--accent)]">‚ù§</span> para celebrar o amor
    </footer>
    <!-- Modal simples -->
  <div id="infoModal" class="hidden fixed inset-0 z-50 items-center justify-center p-4" role="dialog" aria-modal="true" aria-labelledby="infoTitle">
    <div class="absolute inset-0 bg-black/40" data-close="infoModal"></div>
    <div class="relative w-full max-w-sm rounded-2xl bg-white p-5 shadow-xl">
      <div class="flex items-center justify-between">
        <h3 id="infoTitle" class="text-base font-semibold text-gray-900">Aviso</h3>
        <button data-close="infoModal" class="text-gray-500 hover:text-gray-700 rounded-md p-1 focus:outline-none focus:ring-2 focus:ring-[var(--accent)]" aria-label="Fechar">‚úñÔ∏è</button>
      </div>
      <p id="infoText" class="mt-3 text-sm text-gray-700">Aguarde o dia 15 para resgatar üíñ</p>
      <div class="mt-4 text-right">
        <button data-close="infoModal" class="rounded-lg border px-3 py-1.5 text-sm text-gray-700 hover:bg-gray-50">Fechar</button>
      </div>
    </div>
  </div>

  </main>

  <script>
    const START_DATE_ISO = '2025-02-15';
    const LS_KEYS = { lastGift: 'gift_lastRedeem' };
    const WA_URL = 'https://wa.me/5551999970775?text=Acabei%20de%20resgatar%20meu%20cart%C3%A3o%20do%20dia%2015!%20%E2%9D%A4%EF%B8%8F';

    function getTodayBR(){
      const parts = new Intl.DateTimeFormat('pt-BR',{timeZone:'America/Sao_Paulo',day:'2-digit',month:'2-digit',year:'numeric'}).formatToParts(new Date());
      const m = Object.fromEntries(parts.map(p=>[p.type,p.value]));
      return new Date(+m.year, +m.month-1, +m.day);
    }
    function parseISODateOnly(iso){ const [Y,M,D]=iso.split('-').map(Number); return new Date(Y,M-1,D); }
    function diffDays(a,b){ return Math.floor((b-a)/(24*60*60*1000)); }
    const toYYYYMM = d => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;

    const el = {
      totalDays: document.getElementById('totalDays'),
      sinceDate: document.getElementById('sinceDate'),
      btn: document.getElementById('btnRedeem'),
      status: document.getElementById('redeemStatus'),
      giftArea: document.getElementById('giftArea'),
      giftMessage: document.getElementById('giftMessage'),
      giftCode: document.getElementById('giftCode'),
    };

    function updateCounter(){
      const today = getTodayBR();
      const start = parseISODateOnly(START_DATE_ISO);
      const total = diffDays(start,today);
      el.totalDays.textContent = total;
      el.totalDays.classList.remove('pop'); void el.totalDays.offsetWidth; el.totalDays.classList.add('pop');
    }

    function canRedeemToday(){
      const today = getTodayBR();
      if(today.getDate() !== 15) return { ok:false, reason:'not15' };
      const currentYM = toYYYYMM(today);
      const last = localStorage.getItem(LS_KEYS.lastGift)||'';
      if(last === currentYM) return { ok:false, reason:'already' };
      return { ok:true };
    }

    // ‚úÖ Corrigido: else dentro do escopo da fun√ß√£o, sem blocos soltos
    function updateButton(){
      const av = canRedeemToday();
      const btn = el.btn;
      const BASE = 'btn-breath mt-6 w-full rounded-full py-3 text-sm font-semibold shadow-md focus:outline-none';

      if(av.ok){
        btn.disabled = false;
        btn.onclick = () => window.open(WA_URL, '_blank');
        btn.className = BASE + ' bg-emerald-600 hover:bg-emerald-700 text-white focus:ring-2 focus:ring-emerald-400';
        btn.textContent = 'üéÅ Resgatar agora';
        el.status.textContent = 'Dispon√≠vel hoje (dia 15)';
      } else {
        btn.disabled = false; // clic√°vel para mostrar aviso
        btn.onclick = () => openInfo('Aguarde o dia 15 para resgatar üíñ');
        btn.className = BASE + ' bg-[var(--accent)] text-white shadow-md focus:ring-2 focus:ring-[var(--accent)]/30';
        btn.textContent = 'üéÅ Resgatar no dia 15';
        const t = getTodayBR();
        el.status.textContent = (localStorage.getItem(LS_KEYS.lastGift)===toYYYYMM(t)) ? 'J√° resgatado ‚Äî libera na virada do m√™s' : `Hoje √© ${String(t.getDate()).padStart(2,'0')}/${String(t.getMonth()+1).padStart(2,'0')}`;
      }
    }

    function randomGift(){
      const msgs = ['Um passeio juntos','Caf√© da tarde a dois','Filme e pipoca','Jantar rom√¢ntico em casa'];
      const code = 'BRINDE-' + Math.random().toString(36).slice(2,8).toUpperCase();
      return { text: msgs[Math.floor(Math.random()*msgs.length)], code };
    }

    function redeem(){
      const av = canRedeemToday();
      if(!av.ok){ openInfo('Aguarde o dia 15 para resgatar üíñ'); return; }
      localStorage.setItem(LS_KEYS.lastGift, toYYYYMM(getTodayBR()));
      const g = randomGift();
      el.giftMessage.textContent = g.text;
      el.giftCode.textContent = g.code;
      el.giftArea.classList.remove('hidden');
      updateButton();
    }

    document.getElementById('btnRedeem').addEventListener('click', redeem);
    // Modal helpers
    const infoModal = document.getElementById('infoModal');
    const infoText = document.getElementById('infoText');
    function openInfo(msg){ infoText.textContent = msg || 'Aguarde o dia 15 para resgatar üíñ'; infoModal.classList.remove('hidden'); infoModal.classList.add('flex'); }
    function closeInfo(){ infoModal.classList.add('hidden'); infoModal.classList.remove('flex'); }
    document.addEventListener('click', (e)=>{ const c=e.target.closest('[data-close]'); if(c){ closeInfo(); }});
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ closeInfo(); }});

    // ===== Mini testes (n√£o alteram a UI, apenas console) =====
    function canRedeemOn(dateISO, lastGift){
      const d = parseISODateOnly(dateISO);
      if(d.getDate()!==15) return {ok:false, reason:'not15'};
      const ym = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
      if(lastGift===ym) return {ok:false, reason:'already'};
      return {ok:true};
    }
    console.assert(canRedeemOn('2025-10-15','2025-09').ok===true, 'Teste: 15/10 sem resgate pr√©vio deve permitir');
    console.assert(canRedeemOn('2025-10-14','').ok===false, 'Teste: 14/10 deve bloquear');
    console.assert(canRedeemOn('2025-10-15','2025-10').ok===false, 'Teste: 15/10 com resgate no m√™s deve bloquear');

    (function init(){ updateCounter(); updateButton(); })();
  </script>
</body>
</html>
